<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link href="Styles/bootstrap/bootstrap.css" rel="stylesheet" />
    <link href="Styles/style.css" rel="stylesheet" />
    <script src="Scripts/jquery/jquery-2.0.3.js"></script>
    <script src="Scripts/benchmark/benchmark.js"></script>
    <script src="Scripts/common.js"></script>
    <script src="Scripts/graphics.js"></script>
    <script src="Scripts/lsystem.js"></script>
    <script type="text/javascript">

        var drawPane;
        var expr;

        $(function () {
            // 初始化
            drawPane = $('#drawPane')[0];
        });

        function drawGrid(cxt, step) {
            var cw = drawPane.width;
            var ch = drawPane.height;

            cxt.strokeStyle = 'gray';

            cxt.beginPath();
            for (var x = 0; x < cw; x += step) {
                for (var y = 0; y < ch; y += step) {
                    cxt.moveTo(0, y);
                    cxt.lineTo(cw, y);

                    cxt.moveTo(x, 0);
                    cxt.lineTo(x, ch);
                }
            }
            cxt.stroke();
            cxt.closePath();
        }

        function getOption() {
            var opt = {};
            opt.origin = {};
            opt.origin.x = parseInt($('#prop_org_x').val());
            opt.origin.y = parseInt($('#prop_org_y').val());
            opt.angle = parseFloat($('#prop_angle').val());
            opt.deltaAngle = parseFloat($('#prop_delta_angle').val());
            opt.deltaLength= parseFloat($('#prop_delta_length').val());
            opt.depth= parseInt($('#prop_depth').val());
            opt.axiom= $('#prop_axiom').val();
            opt.rules = {};
            for (var i = 0; i < 5; i++) {
                var ruleLeft = $('#prop_rule_left_' + i).val();
                var rule = $('#prop_rule_' + i).val();
                if (ruleLeft && rule) {
                    opt.rules[ruleLeft] = rule;
                }
            }
            return opt;
        }

        function render() {
            var opt = getOption();

            var cxt = drawPane.getContext('2d');
            // 绘制网格
            var step = opt.deltaLength;
            if (step < 5) step = 5;
            drawGrid(cxt, step);

            var ls = new LSystem();
            var expr = ls.generate(opt.axiom, opt.rules, opt.depth);
            $('#expression').val(expr);

            var g = new Graphics(drawPane, true);
            ls.render(g, expr, opt);
        }

    </script>
</head>
<body>
    <div class="drawPane_container">
        <canvas id="drawPane" width="500" height="500" class="drawPane"></canvas>
    </div>
    <div class="expr_container">
        <textarea id="expression" class="expression"></textarea>
    </div>
    <div class="prop_container">
        <table class="table prop_table">
            <thead>
                <tr>
                    <td class="prop_cell prop_head prop_name">名称</td>
                    <td class="prop_cell prop_head prop_value">属性值</td>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="prop_cell">Origin X</td>
                    <td class="prop_cell">
                        <input id="prop_org_x" type="number" class="prop_input" value="250" />
                    </td>
                </tr>
                <tr>
                    <td class="prop_cell">Origin Y</td>
                    <td class="prop_cell">
                        <input id="prop_org_y" type="number" class="prop_input" value="250" />
                    </td>
                </tr>
                <tr>
                    <td class="prop_cell">Angle</td>
                    <td class="prop_cell">
                        <input id="prop_angle" type="number" class="prop_input" value="90" />
                    </td>
                </tr>
                <tr>
                    <td class="prop_cell">Delta Angle</td>
                    <td class="prop_cell">
                        <input id="prop_delta_angle" type="number" class="prop_input" />
                    </td>
                </tr>
                <tr>
                    <td class="prop_cell">Delta Length</td>
                    <td class="prop_cell">
                        <input id="prop_delta_length" type="number" class="prop_input" />
                    </td>
                </tr>
                <tr>
                    <td class="prop_cell">Depth</td>
                    <td class="prop_cell">
                        <input id="prop_depth" type="number" class="prop_input" value="5"/>
                    </td>
                </tr>
                <tr>
                    <td class="prop_cell">Axiom</td>
                    <td class="prop_cell">
                        <input id="prop_axiom" type="text" class="prop_input" />
                    </td>
                </tr>
                <tr>
                    <td class="prop_cell">Rule 1</td>
                    <td class="prop_cell">
                        <input id="prop_rule_left_1" type="text" style="width: 35px;" />
                        ->
                        <input id="prop_rule_1" type="text" style="width: 125px;" />
                    </td>
                </tr>
                <tr>
                    <td class="prop_cell">Rule 2</td>
                    <td class="prop_cell">
                        <input id="prop_rule_left_2" type="text" style="width: 35px;" />
                        ->
                        <input id="prop_rule_2" type="text" style="width: 125px;" />
                    </td>
                </tr>
                <tr>
                    <td class="prop_cell">Rule 3</td>
                    <td class="prop_cell">
                        <input id="prop_rule_left_3" type="text" style="width: 35px;" />
                        ->
                        <input id="prop_rule_3" type="text" style="width: 125px;" />
                    </td>
                </tr>
                <tr>
                    <td class="prop_cell">Rule 4</td>
                    <td class="prop_cell">
                        <input id="prop_rule_left_4" type="text" style="width: 35px;" />
                        ->
                        <input id="prop_rule_4" type="text" style="width: 125px;" />
                    </td>
                </tr>
                <tr>
                    <td class="prop_cell">Rule 5</td>
                    <td class="prop_cell">
                        <input id="prop_rule_left_5" type="text" style="width: 35px;" />
                        ->
                        <input id="prop_rule_5" type="text" style="width: 125px;" />
                    </td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="2" class="prop_cell">
                        <input type="button" value="render" onclick="render();"/>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
</body>
</html>
